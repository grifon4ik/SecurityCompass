# Vulnerability Reporting Tool

## Project Description
The Vulnerability Reporting Tool is a set of automation scripts designed to streamline the process of managing, scanning, and reporting vulnerabilities in container images used in Helm charts. The tool ensures that essential utilities such as Helm, Trivy, jq, and yq are properly installed, and helps users efficiently scan Helm charts for vulnerabilities in container images. The results are saved in a CSV format, which provides easy access to the details of any vulnerabilities found.

## Scripts Overview
vulnerability_scan.sh
This core script extracts container images from a Helm chart, runs a Trivy vulnerability scan on those images, and saves the scan results into a CSV file. It also checks whether the required tools (Helm, Trivy, jq, and yq) are installed and functional. If the required tools are missing or outdated, the script will abort and notify the user..

test_script.sh
This script checks if the essential tools (Helm, Trivy, jq, and yq) are installed and functioning. It also prints the version information for each tool. It's a great way to verify that your environment is set up correctly before running the vulnerability scans.

prerequisites.sh
This script installs the necessary tools (Helm, Trivy, jq, and yq) if they are not already present on the system. It verifies each tool's installation and installs them via package managers or manual installation methods.

CheckOnlyImageNames.sh
This script extracts container image names from a specified Helm chart without performing a vulnerability scan. It’s useful for quickly checking what images are included in a Helm chart, especially if you're only interested in listing the images and not scanning them for vulnerabilities.

remove_tools.sh
This script removes Helm, Trivy, jq, and yq from the system, along with any associated configuration files and caches. It is useful when you need to clean up the system or uninstall these tools.

### Setup and Run Instructions
## Installation and Usage
1. Clone or Download the Scripts: Download or clone the project repository to your local machine.

2. Ensure the Scripts are Executable: Make sure the scripts are executable by running the following command:
```chmod +x *.sh```

3. Run the Scripts:

- Test the Tools (test_script.sh): This script will verify that all the necessary tools are installed and provide version details. Run it like this:
```./test_script.sh```
- Install Missing Tools (prerequisites.sh): This script installs any missing tools if necessary.
Run it with:
```./prerequisites.sh```
- Scan for Vulnerabilities (vulnerability_scan.sh): Use this script to extract images from a Helm chart and run a Trivy scan on each container image:
```./vulnerability_scan.sh <chart_name_with_version>```

Example usage:
```
./vulnerability_scan.sh jenkins/jenkins:3.0.0
./vulnerability_scan.sh bitnami/pytorch:2.6.0
```

This will generate a CSV report showing the vulnerabilities found in each container image.

Extract Image Names Only (CheckOnlyImageNames.sh): If you want to only extract the container images from a Helm chart without performing a scan:
./CheckOnlyImageNames.sh <chart_name_with_version>

Remove Installed Tools (remove_tools.sh): To remove Helm, Trivy, jq, and yq, run:
```./remove_tools.sh```
./vulnerability_scan.sh <chart_name_with_version>
Example:
```
./vulnerability_scan.sh jenkins/jenkins:3.0.0
./vulnerability_scan.sh bitnami/pytorch:2.6.0
```

This will generate a CSV file with the vulnerabilities found in each container image.
Examples folder:
```
2024-12-05_23:13:01_jenkins_jenkins_2.332.3-jdk11_vulnerabilities.csv - report showed result
```
OutputsExamplesFromNames - result from CheckOnlyImageNames.sh

## Example Reports
- After running vulnerability_scan.sh, you will receive a report like:
```
2024-12-05_23:13:01_jenkins_jenkins_2.332.3-jdk11_vulnerabilities.csv
```

- These files contain the detailed vulnerabilities detected in the container images from the specified Helm chart.

Output Examples (Generated by CheckOnlyImageNames.sh):
OutputsExamplesFromNames/
```
├── docker.io_bitnami_pytorch_1.13.1-debian-11-r24_vulnerabilities.csv
├── jenkins_jenkins_2.332.3-jdk11_vulnerabilities.csv
```

### Assumptions and Design Decisions
1. Helm Chart Parsing
The scripts assume that the user provides a valid Helm chart name with an optional version. If no version is provided, the latest version of the chart is used by default.
2. Vulnerability Scan
The vulnerability_scan.sh script is set to scan for vulnerabilities with severity levels MEDIUM, HIGH, and CRITICAL. This can be adjusted within the script to suit different needs.
3. Tool Installation
The prerequisites.sh script ensures that Helm, Trivy, jq, and yq are installed on the system. If any tool is missing, it installs the tool via package managers or downloads directly from the official repositories.
4. File Handling
Vulnerability scan reports are named using the format YYYY-MM-DD_HH:MM:SS_image_name_vulnerabilities.csv, ensuring that each report has a unique name.
If a report file already exists, it is skipped to prevent overwriting.
5.  Cleanup
Temporary files such as images.txt generated by CheckOnlyImageNames.sh are deleted after the script finishes to ensure that no unnecessary files remain.

### Improvements (if more time was available)
1. Parallel Processing:
Currently, the vulnerability scan is run sequentially for each image. Implementing parallel processing (using tools like xargs or running scans in the background) would speed up the process, especially when scanning large Helm charts with many images.
2. User Customization:
It would be beneficial to allow users to specify custom severity levels for the vulnerability scan (e.g., LOW, MEDIUM, HIGH, CRITICAL) or select which types of vulnerabilities they wish to scan for.
Users could also be allowed to configure the format of the output files (e.g., JSON, CSV).
3. Enhanced Error Handling
Improving error handling to deal with edge cases (e.g., network issues during image pulling or scanning, corrupted Helm charts) would make the tool more robust.
4. Logging and Auditing
Adding a centralized logging system would help capture all actions (installation, vulnerability scans, errors, etc.). This would be useful for debugging and auditing purposes.
5. Tool Choice (Trivy or Grype)
Allow the user to choose between Trivy and Grype for scanning images. Some users may prefer one over the other based on their environment or specific needs.
6. Menu-driven Interface
A menu-based option could be added to facilitate easy selection of various scripts to run, making it more user-friendly for non-technical users.



## AI Assistance
AI was used to assist in the following areas:

1. Script Generation:
AI suggested ways to structure the scripts and automate tasks like tool verification, installation, and vulnerability scanning.
2. Code Optimization:

The AI provided insights on how to efficiently handle file creation, error handling, and cleanup of temporary files.
3. Tool Integration:
AI helped determine the best way to integrate tools like Trivy and yq into the workflow to extract images and perform vulnerability scanning.

## Adjustments Made:
- Image Name Sanitization: I modified the scripts to handle image name sanitization more robustly when generating output file names. In the original script, the file names were at risk of being invalid due to the presence of special characters like : and /. I implemented a solution where these characters are replaced with safe alternatives like _ to ensure the output file names are filesystem-friendly and avoid errors.
- CSV Header Row: Initially, the scripts generated CSV files without clear headers. To improve clarity and make the reports more user-friendly, I added a header row to the CSV files. The header row includes labels like image:tag, component/library, vulnerability, and severity, making it easier to understand and process the output.
- Enhanced Error Handling: The error handling was refined to provide more detailed and informative messages. I added checks for specific failure cases, like missing dependencies or failed image scans. Instead of just printing generic error messages, I made sure that the script now outputs relevant troubleshooting tips, which help users identify the root cause of issues quickly.
- Increased Complexity & Functionality: The initial version of the script was relatively simple, performing basic image extraction and vulnerability scanning. Over time, I added more complexity to the scripts, such as the ability to extract container images from Helm charts with optional versioning. I also combined two different scripts into a single, more comprehensive script to streamline the process and reduce redundancy. This integration allowed for better modularity, making the code easier to maintain and extend in the future.
- Advanced Decision Making: As the project progressed, I made more complex design decisions to accommodate the expanding requirements. For instance, I implemented dynamic handling of Helm charts with versions, allowing the user to specify a chart version or defaulting to the latest version if none is provided. I also created more detailed flow control to ensure that users receive clear prompts or warnings if certain conditions are not met, such as missing required tools or invalid chart names.

These enhancements were made to ensure that the scripts are not only functional but also robust, flexible, and easy to use for a broader range of users and use cases.

### Final Notes
If more time were available, the following enhancements would be prioritized:
- **Parallel Processing**: Speed up scanning for large Helm charts.
- **Advanced Configuration Options**: Provide users with more flexibility over the tool's behavior, like severity levels and output formats.
- **Logging**: Implement comprehensive logging for better debugging and auditing.


## Folder Tree:
```
├── CheckOnlyImageNames.sh
├── README.md
├── examples
│   ├── 2024-12-05_23:12:45_docker.io_bitnami_pytorch_1.13.1-debian-11-r24_vulnerabilities.csv
│   ├── 2024-12-05_23:12:57_bats_bats_1.2.1_vulnerabilities.csv
│   ├── 2024-12-05_23:13:01_jenkins_jenkins_2.332.3-jdk11_vulnerabilities.csv
│   ├── 2024-12-05_23:13:06_kiwigrid_k8s-sidecar_1.15.0_vulnerabilities.csv
│   └── OutputsExamplesFromNames
├── prerequisites.sh
├── remove_tools.sh
├── test_script.sh
└── vulnerability_scan.sh
```